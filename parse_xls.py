#!/usr/bin/env python
import sys, string, argparse, os
from collections import namedtuple
try:
    import xlrd
except:
    sys.exit("[!] Please install the xlrd library: pip install xlrd")

def census_parser(filename, verbose):
    # Create the named tuple
    CensusTuple = namedtuple('Census', 'name', 'rank', 'count', 'prop100k', 'cum_prop100k', 'pctwhite', 'pctblack', 'pctapi', 'pctaian', 'pct2prace', 'pctgispanic')
    worksheet_name = "top1000"
    # Define work book and work sheet variables
    workbook = xlrd.open_workbook(filename)
    spreadsheet = workbook.sheet_by_name(worksheet_name)
    total_rows = spreadsheet.nrows -1
    current_row = -1
    # Define holder details
    username_dict = {}
    surname_dict = {}
    alphabet = list(string.ascii_lowercase)
    while current_row<total_rows:
        row = spreadsheet.row(current_row)
        current_row +=1
        entry = CensusTuple(*tuple(row))
        surname_dict[entry.rank] = entry
        cellname = entry.name
        cellrank = entry.rank
        for letter in alphabet:
            if "." not in str(cellrank.value):
                if verbose > 1:
                    print("[-] Eliminating table headers")
                break
            username = letter + str(cellname.value.lower())
            rank = str(cellrank.value)
            username_dict[username] = rank
